"use strict";var W=Object.create;var _=Object.defineProperty;var O=Object.getOwnPropertyDescriptor;var G=Object.getOwnPropertyNames;var J=Object.getPrototypeOf,K=Object.prototype.hasOwnProperty;var Q=(t,s)=>{for(var i in s)_(t,i,{get:s[i],enumerable:!0})},$=(t,s,i,y)=>{if(s&&typeof s=="object"||typeof s=="function")for(let d of G(s))!K.call(t,d)&&d!==i&&_(t,d,{get:()=>s[d],enumerable:!(y=O(s,d))||y.enumerable});return t};var X=(t,s,i)=>(i=t!=null?W(J(t)):{},$(s||!t||!t.__esModule?_(i,"default",{value:t,enumerable:!0}):i,t)),Y=t=>$(_({},"__esModule",{value:!0}),t);var Z={};Q(Z,{ComputerDisplay:()=>U,useVNC:()=>M});module.exports=Y(Z);var g=require("react");var c=require("react"),B=X(require("@novnc/novnc/lib/rfb"));function M({url:t,credentials:s,background:i="#1E1E1E",viewOnly:y=!1,scaleViewport:d=!0,clipViewport:R=!0,resizeSession:T=!0,showDotCursor:x=!0,compressionLevel:L=2,qualityLevel:N=6,onConnect:k,onDisconnect:D,onError:E,onClipboard:F}){let v=(0,c.useRef)(null),o=(0,c.useRef)(null),[h,V]=(0,c.useState)(!1),[S,m]=(0,c.useState)(null),r=(0,c.useRef)(!0),l=(0,c.useRef)(!1),p=(0,c.useRef)(null),f=(0,c.useRef)(0),n=(0,c.useRef)(!1),b=(0,c.useCallback)(()=>{if(!l.current){if(l.current=!0,p.current&&(clearTimeout(p.current),p.current=null),o.current){let e=o.current;o.current=null;try{["connect","disconnect","credentialsrequired","securityfailure","clipboard"].forEach(a=>{let C=e._eventListeners?.[a];Array.isArray(C)&&[...C].forEach(H=>{try{e.removeEventListener(a,H)}catch{}})})}catch{}try{let u=e._sock?._websocket;u?.readyState===WebSocket.OPEN&&u.close(1e3,"Normal closure")}catch{}try{e.disconnect()}catch{}}l.current=!1}},[]),w=(0,c.useCallback)(()=>{!v.current||!t||!r.current||n.current||l.current||(n.current=!0,setTimeout(()=>{if(!r.current||!v.current){n.current=!1;return}try{let e=new B.default(v.current,t,{credentials:{username:s?.username||"",password:s?.password||"",target:s?.target||""},shared:!0});e.viewOnly=y,e.scaleViewport=d,e.clipViewport=R,e.resizeSession=T,e.background=i,e.compressionLevel=L,e.qualityLevel=N,e.showDotCursor=x,e.focusOnClick=!0,e.addEventListener("connect",(()=>{if(!r.current){try{e.disconnect()}catch{}n.current=!1;return}V(!0),m(null),f.current=0,n.current=!1,k?.()})),e.addEventListener("clipboard",(u=>{let a=u.detail;!r.current||!a?.text||(F?.(a.text),navigator.clipboard?.writeText&&navigator.clipboard.writeText(a.text).catch(()=>{}))})),e.addEventListener("disconnect",(u=>{let a=u.detail;if(!r.current){n.current=!1;return}if(V(!1),D?.(a?.clean??!0),a?.clean===!1&&r.current&&f.current<5){let C=Math.min(1e3*Math.pow(1.5,f.current)+Math.random()*300,8e3);p.current=setTimeout(()=>{r.current&&!l.current?(f.current++,n.current=!1,o.current&&b(),setTimeout(()=>r.current&&w(),100)):n.current=!1},C),m(`Reconnecting... (${f.current+1}/5)`)}else a?.clean===!1&&(m("Connection lost"),E?.("Connection lost")),n.current=!1})),e.addEventListener("securityfailure",(u=>{let a=u.detail;if(!r.current){n.current=!1;return}let C=a?.reason||`Code ${a?.status||"unknown"}`;C.includes("Resize is administratively prohibited")||(m(`Security failure: ${C}`),E?.(`Security failure: ${C}`)),n.current=!1})),e.addEventListener("credentialsrequired",(()=>{if(!r.current){n.current=!1;return}m("Credentials required"),E?.("Credentials required"),n.current=!1})),o.current=e,setTimeout(()=>{if(o.current&&v.current){window.dispatchEvent(new Event("resize"));let u=v.current.querySelector("canvas");u&&(u.style.width="100%",u.style.height="100%")}},500)}catch(e){if(!r.current){n.current=!1;return}let u=e instanceof Error?e.message:"Unknown error";m(`Connection error: ${u}`),E?.(u),n.current=!1,f.current<3&&r.current&&(p.current=setTimeout(()=>{r.current&&!l.current&&(f.current++,w())},2e3*Math.pow(1.3,f.current)))}},l.current?200:50))},[t,s,i,y,d,R,T,x,L,N,k,D,E,F,b]);(0,c.useEffect)(()=>{r.current=!0,b();let e=setTimeout(()=>t&&r.current&&w(),100);return()=>{if(r.current=!1,clearTimeout(e),p.current&&clearTimeout(p.current),o.current){try{o.current._sock?._websocket?.close(1e3,"Normal closure"),o.current.disconnect()}catch{}o.current=null}l.current=!1,n.current=!1}},[t,s,w,b]);let q=(0,c.useCallback)(()=>{l.current||n.current||(f.current=0,m(null),b(),setTimeout(()=>r.current&&w(),200))},[w,b]),z=(0,c.useCallback)(e=>{if(o.current&&h&&e)try{return o.current.clipboardPasteFrom(e),!0}catch{}return!1},[h]),A=(0,c.useCallback)(async()=>{if(o.current&&h)try{let e=await navigator.clipboard.readText();if(e)return o.current.clipboardPasteFrom(e),!0}catch{}return!1},[h]);return{vncRef:v,isConnected:h,error:S,reconnect:q,disconnect:b,sendClipboard:z,pasteFromClipboard:A}}var P=require("react/jsx-runtime"),U=(0,g.forwardRef)(({instanceId:t,password:s,readOnly:i=!1,background:y="#1E1E1E",className:d,style:R,scaleViewport:T=!0,clipViewport:x=!0,resizeSession:L=!0,showDotCursor:N=!0,compressionLevel:k=2,qualityLevel:D=6,onConnect:E,onDisconnect:F,onError:v,onClipboard:o},h)=>{let V=(0,g.useMemo)(()=>`wss://${t}.orgo.dev/websockify`,[t]),S=(0,g.useMemo)(()=>({username:"user",password:s,target:`${t}.orgo.dev`}),[t,s]),{vncRef:m,isConnected:r,reconnect:l,disconnect:p,sendClipboard:f,pasteFromClipboard:n}=M({url:V,credentials:S,background:y,viewOnly:i,scaleViewport:T,clipViewport:x,resizeSession:L,showDotCursor:N,compressionLevel:k,qualityLevel:D,onConnect:E,onDisconnect:F,onError:v,onClipboard:o});return(0,g.useImperativeHandle)(h,()=>({reconnect:l,disconnect:p,sendClipboard:f,pasteFromClipboard:n,isConnected:r}),[l,p,f,n,r]),(0,P.jsx)("div",{ref:m,className:d,style:{width:"100%",height:"100%",background:y,pointerEvents:i?"none":"auto",cursor:i?"default":"none",opacity:r?1:0,transition:"opacity 0.3s ease-in-out",...R}})});U.displayName="ComputerDisplay";0&&(module.exports={ComputerDisplay,useVNC});
//# sourceMappingURL=index.js.map