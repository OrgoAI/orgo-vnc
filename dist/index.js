"use strict";var W=Object.create;var M=Object.defineProperty;var G=Object.getOwnPropertyDescriptor;var J=Object.getOwnPropertyNames;var K=Object.getPrototypeOf,Q=Object.prototype.hasOwnProperty;var X=(t,s)=>{for(var i in s)M(t,i,{get:s[i],enumerable:!0})},q=(t,s,i,v)=>{if(s&&typeof s=="object"||typeof s=="function")for(let d of J(s))!Q.call(t,d)&&d!==i&&M(t,d,{get:()=>s[d],enumerable:!(v=G(s,d))||v.enumerable});return t};var B=(t,s,i)=>(i=t!=null?W(K(t)):{},q(s||!t||!t.__esModule?M(i,"default",{value:t,enumerable:!0}):i,t)),Y=t=>q(M({},"__esModule",{value:!0}),t);var Z={};X(Z,{ComputerDisplay:()=>$,useVNC:()=>_});module.exports=Y(Z);var p=require("react");var n=require("react");function _({url:t,credentials:s,background:i="#1E1E1E",viewOnly:v=!1,scaleViewport:d=!0,clipViewport:L=!0,resizeSession:T=!0,showDotCursor:x=!0,compressionLevel:k=2,qualityLevel:N=6,onConnect:D,onDisconnect:F,onError:g,onClipboard:V}){let w=(0,n.useRef)(null),o=(0,n.useRef)(null),m=(0,n.useRef)(null),[C,S]=(0,n.useState)(!1),[P,E]=(0,n.useState)(null),c=(0,n.useRef)(!0),a=(0,n.useRef)(!1),y=(0,n.useRef)(null),f=(0,n.useRef)(0),r=(0,n.useRef)(!1);(0,n.useEffect)(()=>{typeof window<"u"&&!m.current&&import("@novnc/novnc/lib/rfb").then(e=>{m.current=e.default})},[]);let b=(0,n.useCallback)(()=>{if(!a.current){if(a.current=!0,y.current&&(clearTimeout(y.current),y.current=null),o.current){let e=o.current;o.current=null;try{["connect","disconnect","credentialsrequired","securityfailure","clipboard"].forEach(l=>{let h=e._eventListeners?.[l];Array.isArray(h)&&[...h].forEach(H=>{try{e.removeEventListener(l,H)}catch{}})})}catch{}try{let u=e._sock?._websocket;u?.readyState===WebSocket.OPEN&&u.close(1e3,"Normal closure")}catch{}try{e.disconnect()}catch{}}a.current=!1}},[]),R=(0,n.useCallback)(()=>{!w.current||!t||!c.current||r.current||a.current||!m.current||(r.current=!0,setTimeout(()=>{if(!c.current||!w.current||!m.current){r.current=!1;return}try{let e=new m.current(w.current,t,{credentials:{username:s?.username||"",password:s?.password||"",target:s?.target||""},shared:!0});e.viewOnly=v,e.scaleViewport=d,e.clipViewport=L,e.resizeSession=T,e.background=i,e.compressionLevel=k,e.qualityLevel=N,e.showDotCursor=x,e.focusOnClick=!0,e.addEventListener("connect",(()=>{if(!c.current){try{e.disconnect()}catch{}r.current=!1;return}S(!0),E(null),f.current=0,r.current=!1,D?.()})),e.addEventListener("clipboard",(u=>{let l=u.detail;!c.current||!l?.text||(V?.(l.text),navigator.clipboard?.writeText&&navigator.clipboard.writeText(l.text).catch(()=>{}))})),e.addEventListener("disconnect",(u=>{let l=u.detail;if(!c.current){r.current=!1;return}if(S(!1),F?.(l?.clean??!0),l?.clean===!1&&c.current&&f.current<5){let h=Math.min(1e3*Math.pow(1.5,f.current)+Math.random()*300,8e3);y.current=setTimeout(()=>{c.current&&!a.current?(f.current++,r.current=!1,o.current&&b(),setTimeout(()=>c.current&&R(),100)):r.current=!1},h),E(`Reconnecting... (${f.current+1}/5)`)}else l?.clean===!1&&(E("Connection lost"),g?.("Connection lost")),r.current=!1})),e.addEventListener("securityfailure",(u=>{let l=u.detail;if(!c.current){r.current=!1;return}let h=l?.reason||`Code ${l?.status||"unknown"}`;h.includes("Resize is administratively prohibited")||(E(`Security failure: ${h}`),g?.(`Security failure: ${h}`)),r.current=!1})),e.addEventListener("credentialsrequired",(()=>{if(!c.current){r.current=!1;return}E("Credentials required"),g?.("Credentials required"),r.current=!1})),o.current=e,setTimeout(()=>{if(o.current&&w.current){window.dispatchEvent(new Event("resize"));let u=w.current.querySelector("canvas");u&&(u.style.width="100%",u.style.height="100%")}},500)}catch(e){if(!c.current){r.current=!1;return}let u=e instanceof Error?e.message:"Unknown error";E(`Connection error: ${u}`),g?.(u),r.current=!1,f.current<3&&c.current&&(y.current=setTimeout(()=>{c.current&&!a.current&&(f.current++,R())},2e3*Math.pow(1.3,f.current)))}},a.current?200:50))},[t,s,i,v,d,L,T,x,k,N,D,F,g,V,b]);(0,n.useEffect)(()=>{c.current=!0;let e=setTimeout(()=>{m.current&&t&&c.current?R():!m.current&&typeof window<"u"&&import("@novnc/novnc/lib/rfb").then(u=>{m.current=u.default,t&&c.current&&R()})},100);return()=>{if(c.current=!1,clearTimeout(e),y.current&&clearTimeout(y.current),o.current){try{o.current._sock?._websocket?.close(1e3,"Normal closure"),o.current.disconnect()}catch{}o.current=null}a.current=!1,r.current=!1}},[t,s,R,b]);let z=(0,n.useCallback)(()=>{a.current||r.current||(f.current=0,E(null),b(),setTimeout(()=>c.current&&R(),200))},[R,b]),O=(0,n.useCallback)(e=>{if(o.current&&C&&e)try{return o.current.clipboardPasteFrom(e),!0}catch{}return!1},[C]),A=(0,n.useCallback)(async()=>{if(o.current&&C)try{let e=await navigator.clipboard.readText();if(e)return o.current.clipboardPasteFrom(e),!0}catch{}return!1},[C]);return{vncRef:w,isConnected:C,error:P,reconnect:z,disconnect:b,sendClipboard:O,pasteFromClipboard:A}}var U=require("react/jsx-runtime"),$=(0,p.forwardRef)(({instanceId:t,password:s,readOnly:i=!1,background:v="#1E1E1E",className:d,style:L,scaleViewport:T=!0,clipViewport:x=!0,resizeSession:k=!0,showDotCursor:N=!0,compressionLevel:D=2,qualityLevel:F=6,onConnect:g,onDisconnect:V,onError:w,onClipboard:o},m)=>{let[C,S]=(0,p.useState)(!1);(0,p.useEffect)(()=>{S(!0)},[]);let P=(0,p.useMemo)(()=>C?`wss://${t}.orgo.dev/websockify`:"",[t,C]),E=(0,p.useMemo)(()=>({username:"user",password:s,target:`${t}.orgo.dev`}),[t,s]),{vncRef:c,isConnected:a,reconnect:y,disconnect:f,sendClipboard:r,pasteFromClipboard:b}=_({url:P,credentials:E,background:v,viewOnly:i,scaleViewport:T,clipViewport:x,resizeSession:k,showDotCursor:N,compressionLevel:D,qualityLevel:F,onConnect:g,onDisconnect:V,onError:w,onClipboard:o});return(0,p.useImperativeHandle)(m,()=>({reconnect:y,disconnect:f,sendClipboard:r,pasteFromClipboard:b,isConnected:a}),[y,f,r,b,a]),C?(0,U.jsx)("div",{ref:c,className:d,style:{width:"100%",height:"100%",background:v,pointerEvents:i?"none":"auto",cursor:i?"default":"none",opacity:a?1:0,transition:"opacity 0.3s ease-in-out",...L}}):(0,U.jsx)("div",{className:d,style:{width:"100%",height:"100%",background:v,...L}})});$.displayName="ComputerDisplay";0&&(module.exports={ComputerDisplay,useVNC});
//# sourceMappingURL=index.js.map